FROM golang:1.22

WORKDIR /app

COPY go.mod go.sum ./
RUN go mod download

COPY . ./

ARG DEBUG=""
ENV E_DEBUG=$DEBUG
RUN ./build.sh

ENV DATABASE_HOSTNAME="hostname"
ENV DATABASE_PORT="5432"
ENV DATABASE_NAME="motmot"
ENV DATABASE_USERNAME="motmot"
ENV DATABASE_PASSWORD=""
ENV PORT="8080"
ENV SECRET=""
ENV ENDPOINT="/api"

CMD ["sh", "-c", "/api -r $DATABASE_HOSTNAME -c $DATABASE_PORT -d $DATABASE_NAME -u $DATABASE_USERNAME -p $DATABASE_PASSWORD -s $PORT -x $SECRET"]